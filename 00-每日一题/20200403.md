





> ä»å‰çš„æ—¥è‰²å˜å¾—æ…¢   è½¦ï¼Œé©¬ï¼Œé‚®ä»¶éƒ½æ…¢

![](https://mmbiz.qpic.cn/mmbiz_jpg/iaXVic9tQZLSJbgGfhF03qrZvYhLT5B5Ovx4IGVSHENSjPULkaVz9FLCdWE1nPTDj92vJziaVaTicE3Kw7iaHLtlbBg/640?wx_fmt=jpeg&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

> çŸ¥è¯†æ‹“å±•ï¼šæ ‘çŠ¶æ•°ç»„
>
> ## æ ‘çŠ¶æ•°ç»„èƒ½è§£å†³çš„é—®é¢˜
>
> æ ‘çŠ¶æ•°ç»„ï¼Œä¹Ÿç§°ä½œâ€œäºŒå‰ç´¢å¼•æ ‘â€ï¼ˆBinary Indexed Treeï¼‰æˆ– Fenwick æ ‘ã€‚ å®ƒé«˜æ•ˆåœ°å®ç°å¦‚ä¸‹ä¸¤ä¸ªæ“ä½œï¼š
>
> 1ã€æ•°ç»„çš„â€œå‰ç¼€å’Œâ€æŸ¥è¯¢ï¼›
>
> 2ã€å•ç‚¹æ›´æ–°ã€‚
>
> ä¸‹é¢å…·ä½“è§£é‡Šè¿™ä¸¤ä¸ªæ“ä½œã€‚
>
> ### 1ã€æ•°ç»„çš„â€œå‰ç¼€å’Œâ€æŸ¥è¯¢
>
> é¦–å…ˆçœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼Œäº†è§£ä»€ä¹ˆæ˜¯æ•°ç»„çš„å‰ç¼€å’ŒæŸ¥è¯¢ã€‚
>
> ä¾‹1ï¼šå·²çŸ¥æ•°ç»„ `arr = [10, 15, 17, 19, 20, 14, 12]`ï¼Œæ±‚ç´¢å¼• `0` è‡³ç´¢å¼• `4` çš„æ‰€æœ‰å…ƒç´ çš„å’Œã€‚
>
> åˆ†æï¼šâ€œå‰ç¼€å’Œâ€å®šä¹‰äº†ä¸€ä¸ªæ•°ç»„**ä»â€œå¤´â€å¼€å§‹çš„åŒºé—´**ï¼Œè®¡ç®—çš„æ˜¯ä»**ç´¢å¼•ä½ç½®æ˜¯ 0** å¼€å§‹çš„åŒºé—´å†…çš„æ‰€æœ‰å…ƒç´ çš„å’Œã€‚
>
> æ³¨æ„ï¼š1ã€ç†è§£â€œå‰ç¼€â€çš„æ„æ€ï¼Œå› ä¸ºæ˜¯â€œå‰ç¼€â€ï¼Œæ‰€ä»¥ç´¢å¼•ä½ç½®ä» `0` å¼€å§‹è®¡ç®—ï¼›
>
> 2ã€å…¶å®ƒä¸æ˜¯ä» `0` å¼€å§‹çš„æ•°ç»„çš„åŒºé—´å’Œå¯ä»¥è½¬åŒ–æˆå‰é¢çš„è¿™ä¸ªé—®é¢˜ã€‚
>
> è§£ï¼šåœ¨ Python è¯­è¨€ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ `sum(arr[0:5])` å¾—åˆ°ç´¢å¼• `0` è‡³ç´¢å¼• `4` çš„æ‰€æœ‰å…ƒç´ çš„å’Œã€‚
>
> è¯´æ˜ï¼šåœ¨ Python çš„è¯­æ³•ä¸­ï¼Œåˆ‡ç‰‡æ“ä½œä¸åŒ…æ‹¬ç»“å°¾ç´¢å¼•çš„æ•°å€¼ï¼Œå› æ­¤ `arr[0:5]=[arr[0], arr[1], arr[2], arr[3], arr[4]]`ã€‚
>
> ### 2ã€â€œå•ç‚¹æ›´æ–°â€ æ“ä½œ
>
> ä¾‹ 2ï¼šå·²çŸ¥æ•°ç»„ `[10, 15, 17, 19, 20, 14, 12]` ã€‚
>
> 1ã€å°†ç´¢å¼•ä¸º `4` çš„å…ƒç´ å¢åŠ  `2`ï¼›
>
> 2ã€å°†ç´¢å¼•ä¸º `6` çš„å…ƒç´ å‡å°‘ `3`ã€‚
>
> åˆ†æï¼šç»™å‡ºè¿™ä¸ªä¾‹é¢˜åªæ˜¯ä¸ºäº†è®©å¤§å®¶ç†Ÿæ‚‰è¿™ä¸ªææ³•ï¼Œâ€œå•ç‚¹æ›´æ–°â€å¹¶ä¸å…³å¿ƒè¿™ä¸ªæ•°â€œå˜æˆäº†ä»€ä¹ˆâ€ï¼Œå®ƒçš„ææ³•æ˜¯**ç»™å‡ºä¸€ä¸ªæ•°å˜åŒ–äº†å¤šå°‘**ï¼Œå› ä¸ºå¢åŠ ä¸€ä¸ªæ•°ç­‰ä»·äºå‡å»è¿™ä¸ªæ•°çš„ç›¸åæ•°ï¼Œå› æ­¤ä»¥ä¸Šä¸¤ä¸ªææ³•å…¶å®å¯ä»¥åˆå¹¶æˆï¼š**å°†æŸä¸ªç´¢å¼•çš„å…ƒç´ å¢åŠ å¤šå°‘**ã€‚
>
> å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ä»»ä½•ä»»ä½•æ•°æ®ç»“æ„ï¼Œä»…ä¾é å®šä¹‰ï¼Œâ€œå•ç‚¹æ›´æ–°â€ æ“ä½œçš„æ—¶é—´å¤æ‚åº¦æ˜¯O(1)ï¼Œæ•°ç»„çš„â€œå‰ç¼€å’Œâ€æŸ¥è¯¢çš„æ—¶é—´å¤æ‚åº¦æ˜¯ *ğ‘‚*(*ğ‘›*)O(n)ï¼Œè¦æ‰«æè¿™ä¸ªåŒºé—´çš„ä¸€å¤§éƒ¨åˆ†å…ƒç´ ï¼Œæ‰èƒ½å¾—åˆ°è¿™ä¸ªåŒºé—´çš„å’Œã€‚ä¼˜åŒ–çš„åšæ³•æ˜¯ï¼šå…ˆè®¡ç®—å‡ºä¸€ä¸ªâ€œå‰ç¼€å’Œâ€æ•°ç»„ï¼Œè¿™ä¸ªæ•°ç»„çš„æ¯ä¸ªå…ƒç´ çš„å€¼å¯¹åº”çš„æ­£æ˜¯åŸæ¥æ•°ç»„çš„å‰ç¼€å’Œã€‚
>
> ä¾‹3ï¼šå·²çŸ¥æ•°ç»„ `arr = [1, 2, 3, 4, 5, 6, 7]`ï¼Œè®¡ç®—â€œå‰ç¼€å’Œâ€æ•°ç»„ `cumsum(arr)`ã€‚
>
> åˆ†æï¼šæ ¹æ®â€œå‰ç¼€å’Œâ€çš„å®šä¹‰ï¼Œå®¹æ˜“è®¡ç®—å‡ºâ€œå‰ç¼€å’Œâ€æ•°ç»„æ˜¯ `cumsum(arr) = [1, 3, 6, 10, 15, 21, 28]`ã€‚
>
> **é‚£ä¹ˆé—®é¢˜æ¥äº†**ï¼šæ‰§è¡Œâ€œå•ç‚¹æ›´æ–°â€æ“ä½œï¼Œå°±å¾—æ›´æ–°â€œå‰ç¼€å’Œâ€æ•°ç»„åˆå¾—è®¡ç®—ä¸€æ¬¡å‰ç¼€å’Œï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O(n)ã€‚é‚£å¦‚æœä¸€æ¬¡ä¸šåŠ¡åœºæ™¯ä¸­è®¡ç®—â€œå‰ç¼€å’Œâ€å’Œâ€œå•ç‚¹æ›´æ–°æ“ä½œâ€çš„æ¬¡æ•°éƒ½å¾ˆå¤šï¼Œä½¿ç”¨â€œå‰ç¼€å’Œâ€æ•°ç»„å°±ä¸é«˜æ•ˆäº†ã€‚è€Œ Fenwick æ ‘å°±æ˜¯ä¸€ä¸ªå®ç°äº†å¿«é€Ÿè®¡ç®—â€œå‰ç¼€å’Œâ€å’Œâ€œå•ç‚¹æ›´æ–°â€æ“ä½œè¿™ä¸¤ä¸ªæ“ä½œçš„æ•°æ®ç»“æ„ã€‚
>
> æˆ‘ä»¬é¦–å…ˆå…ˆçœ‹çœ‹æ ‘çŠ¶æ•°ç»„é•¿ä»€ä¹ˆæ ·ã€‚
>
> 
>
> ![](https://liweiwei1419.github.io/images/algorithms/fenwick-tree/fenwick-tree-5.jpg)
>
> ä¾‹5ï¼šæˆ‘ä»¬ä»¥ä¸€ä¸ªæœ‰ `8` ä¸ªå…ƒç´ çš„æ•°ç»„ `A` ä¸ºä¾‹ï¼ˆå¦‚ä¸Šå›¾ï¼‰ï¼Œåœ¨æ•°ç»„ `A` ä¹‹ä¸Šå»ºç«‹ä¸€ä¸ªæ•°ç»„ `C`ï¼Œä½¿å¾—æ•°ç»„ `C` çš„å½¢æˆå¦‚ä¸Šçš„ä¸€ä¸ªå¤šå‰æ ‘å½¢çŠ¶ï¼Œæ•°ç»„ `C` å°±å½¢æˆäº†ä¸€ä¸ªæ ‘çŠ¶æ•°ç»„çš„ç»“æ„ã€‚ä»¥ä¸‹æ˜¯ä¸¤ç‚¹è¯´æ˜ï¼š
>
> 1ã€æ ‘çŠ¶æ•°ç»„è¦å»ºæˆåŠ¨æ€çš„æ ‘å½¢ç»“æ„å—ï¼Ÿ
>
> åˆ†æï¼šä¸ã€‚å­¦ä¹ è¿‡å †ã€çº¿æ®µæ ‘çš„æœ‹å‹ä¸€å®šçŸ¥é“ï¼Œä½¿ç”¨æ•°ç»„å°±èƒ½æ–¹ä¾¿åœ°ç´¢å¼•å·¦å³å­©å­ç»“ç‚¹ã€åŒäº²ç»“ç‚¹ï¼ˆå› ä¸ºè§„å¾‹ç‰¹åˆ«å®¹æ˜“æ‰¾åˆ°ï¼‰ï¼Œè¿™æ ·çš„æ ‘å°±ä¸å¿…åˆ›å»ºæˆç»“ç‚¹ã€æŒ‡é’ˆé‚£æ ·çš„åŠ¨æ€æ ‘å½¢ç»“æ„ã€‚
>
> 2ã€å¦‚ä½•è§£é‡Šâ€œå‰ç¼€å’Œâ€æŸ¥è¯¢å’Œâ€œå•ç‚¹æ›´æ–°â€æ“ä½œï¼Ÿ
>
> åˆ†æï¼šå¦‚æœè¦æŸ¥è¯¢â€œå‰ç¼€å’Œ44â€ï¼Œæœ¬æ¥åº”è¯¥æŸ¥ `A1`ã€`A2`ã€`A3`ã€`A4`ï¼Œç„¶åæŠŠå®ƒä»¬ç›¸åŠ ï¼Œæœ‰äº†æ•°ç»„ `C` ä¹‹åï¼Œæˆ‘ä»¬åªè¦é—® `C4` å³å¯ã€‚å†å¦‚ï¼Œæˆ‘ä»¬è¦æ›´æ–°ç»“ç‚¹ `A1` çš„å€¼ï¼Œåªè¦è‡ªåº•å‘ä¸Šæ›´æ–° `C1`ã€`C2`ã€`C4`ã€`C8` çš„å€¼å³å¯ã€‚
>
> æˆ‘ä»¬æ„å»ºå¥½æ•°ç»„ `C` ä»¥åï¼Œå°±å®Œå…¨å¯ä»¥æŠ›å¼ƒæ•°ç»„ `A` äº†ã€‚
>
> ## ç†è§£æ•°ç»„ C çš„å®šä¹‰
>
> é¦–å…ˆæˆ‘ä»¬å¼ºè°ƒä¸€ç‚¹ï¼Œ**æ ‘çŠ¶æ•°ç»„çš„ä¸‹æ ‡ä» 1 å¼€å§‹ï¼Œ00å·ç´¢å¼•æˆ‘ä»¬ä¸ç”¨**ï¼Œè¿™ä¸€ç‚¹æˆ‘ä»¬çœ‹åˆ°åé¢å°±ä¼šæ˜ç™½ã€‚æˆ‘ä»¬å…ˆäº†è§£å¦‚ä¸‹çš„å®šä¹‰ï¼Œè¯·å¤§å®¶ä¸€å®šå…ˆè®°ä½è¿™äº›è®°å·æ‰€ä»£è¡¨çš„å«ä¹‰ï¼š
>
> 1ã€æ•°ç»„ `C` æ˜¯ä¸€ä¸ªå¯¹åŸå§‹æ•°ç»„ `A` çš„é¢„å¤„ç†æ•°ç»„ã€‚
>
> 2ã€æˆ‘ä»¬è¿˜è¦ç†Ÿæ‚‰å‡ ä¸ªè®°å·ã€‚ä¸ºäº†æ–¹ä¾¿è¯´æ˜ï¼Œé¿å…åé¢è¡Œæ–‡å•°å—¦ï¼Œæˆ‘ä»¬å°†å›ºå®šä½¿ç”¨è®°å· i ã€j ã€kï¼Œå®ƒä»¬çš„å®šä¹‰å¦‚ä¸‹ï¼š
> è®°å· i ï¼šè¡¨ç¤ºé¢„å¤„ç†æ•°ç»„ C çš„ç´¢å¼•ï¼ˆåè¿›åˆ¶è¡¨ç¤ºï¼‰ã€‚
> è®°å· j ï¼šè¡¨ç¤ºåŸå§‹æ•°ç»„ A çš„ç´¢å¼•ï¼ˆåè¿›åˆ¶è¡¨ç¤ºï¼‰ã€‚
> æˆ‘ä»¬é€šè¿‡ä»¥ä¸‹çš„å›¾ï¼Œæ¥çœ‹çœ‹ `C1`ã€`C2`ã€`C3`ã€`C4`ã€`C5`ã€`C6`ã€`C7`ã€`C8` åˆ†åˆ«æ˜¯å¦‚ä½•å®šä¹‰çš„ã€‚
>
> 
>
> ![é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„â€”2](https://liweiwei1419.github.io/images/algorithms/fenwick-tree/fenwick-tree-1.jpg)
>
> **é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„â€”2**
>
> 
>
> 
>
> ![é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-3](https://liweiwei1419.github.io/images/algorithms/fenwick-tree/fenwick-tree-2.jpg)
>
> **é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-3**
>
> 
>
> 
>
> ![é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-4](https://liweiwei1419.github.io/images/algorithms/fenwick-tree/fenwick-tree-3.jpg)
>
> **é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-4**
>
> 
>
> 
>
> ![é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-5](https://liweiwei1419.github.io/images/algorithms/fenwick-tree/fenwick-tree-4.jpg)
>
> **é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-5**
>
> 
>
> ä¸Šé¢çš„è¿‡ç¨‹æˆ‘ä»¬ç”¨å¦‚ä¸‹çš„è¡¨æ¥è¡¨ç¤ºã€‚
>
> 
>
> ![é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-6](https://liweiwei1419.github.io/images/algorithms/fenwick-tree/fenwick-tree-6.jpg)
>
> **é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-6**
>
> 
>
> ## æ•°ç»„ C çš„ç´¢å¼•ä¸æ•°ç»„ A çš„ç´¢å¼•çš„å…³ç³»
>
> ä¼Ÿå¤§çš„è®¡ç®—æœºç§‘å­¦å®¶æ³¨æ„åˆ°ä¸Šè¡¨ä¸­æ ‡æ³¨äº†â€œæ•°ç»„ C ä¸­çš„å…ƒç´ æ¥è‡ªæ•°ç»„ A çš„å…ƒç´ ä¸ªæ•°â€ï¼Œå®ƒä»¬çš„è§„å¾‹å¦‚ä¸‹ï¼šå°†æ•°ç»„Cçš„ç´¢å¼• i è¡¨ç¤ºæˆäºŒè¿›åˆ¶ï¼Œä»å³å‘å·¦æ•°ï¼Œé‡åˆ° 1 åˆ™åœæ­¢ï¼Œæ•°å‡º 0 çš„ä¸ªæ•°è®°ä¸º kï¼Œåˆ™è®¡ç®— 2k å°±æ˜¯â€œæ•°ç»„ C ä¸­çš„å…ƒç´ æ¥è‡ªæ•°ç»„ A çš„ä¸ªæ•°â€ï¼Œå¹¶ä¸”å¯ä»¥å…·ä½“å¾—åˆ°æ¥è‡ªæ•°ç»„A çš„è¡¨ç¤ºï¼Œå³ä»å½“å‰ç´¢å¼• i å¼€å§‹ï¼Œä»å³å‘å‰æ•°å‡º 2k ä¸ªæ•°ç»„ A ä¸­çš„å…ƒç´ çš„å’Œï¼Œå³ç»„æˆäº†C[i]ã€‚ä¸‹é¢å…·ä½“è¯´æ˜ã€‚
>
> è®°å· k ï¼šå°† i çš„äºŒè¿›åˆ¶è¡¨ç¤ºä»å³å‘å·¦æ•°å‡ºçš„ 0 çš„ä¸ªæ•°ï¼Œé‡åˆ° 1 åˆ™åœæ­¢ï¼Œè®°ä¸º kã€‚ æˆ‘ä»¬åªå¯¹æ•°ç»„C çš„ç´¢å¼• i è¿›è¡Œè¿™ä¸ªè®¡ç®—ï¼Œæ•°ç»„A çš„ç´¢å¼• j ä¸è¿›è¡Œç›¸åº”çš„è®¡ç®—ã€‚ç†è§£k æ˜¯å¦‚ä½•å¾—åˆ°çš„æ˜¯å…³é”®ï¼Œè¯·åŠ¡å¿…é‡è§†ã€‚ä¸‹é¢æˆ‘ä»¬é€šè¿‡ä¸¤ä¸ªä¾‹å­è¿›è¡Œè¯´æ˜ã€‚
>
> > ä¾‹6ï¼šå½“ i=5 æ—¶ï¼Œè®¡ç®— kã€‚
> >
> > åˆ†æï¼šå› ä¸º 5 çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ 00000101ï¼Œä»å³è¾¹å‘å·¦è¾¹æ•°ï¼Œç¬¬ 1 ä¸ªæ˜¯ 1 ï¼Œå› æ­¤ 0 çš„ä¸ªæ•°æ˜¯ 0ï¼Œæ­¤æ—¶ k=0ã€‚
> >
> > ä¾‹7ï¼šå½“i=8 æ—¶ï¼Œè®¡ç®— kã€‚
> >
> > åˆ†æï¼šå› ä¸º 8 çš„äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ 00001000ï¼Œä»å³è¾¹å‘å·¦è¾¹æ•°é‡åˆ° 1 ä¹‹å‰ï¼Œé‡åˆ°äº† 3 ä¸ª 0ï¼Œæ­¤æ—¶ k = 3ã€‚
>
> è®¡ç®—å‡º k ä»¥åï¼Œ2k ç«‹é©¬å¾—åˆ°ï¼Œä¸ºæ­¤æˆ‘ä»¬å¯ä»¥ç”»å‡ºå¦‚ä¸‹è¡¨æ ¼ï¼š
>
> 
>
> ![é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-7](https://liweiwei1419.github.io/images/algorithms/fenwick-tree/fenwick-tree-7.jpg)
>
> **é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-7**
>
> 
>
> æˆ‘ä»¬çœ‹åˆ° 2k æ˜¯æˆ‘ä»¬æœ€ç»ˆæƒ³è¦çš„ã€‚ä¸‹é¢æˆ‘ä»¬ä»‹ç»ä¸€ç§å¾ˆé…·çš„æ“ä½œï¼Œå«åš `lowbit` ï¼Œå®ƒå¯ä»¥é«˜æ•ˆåœ°è®¡ç®—2kï¼Œå³æˆ‘ä»¬è¦è¯æ˜ï¼š
>
> 
>
> lowbit(i)=2k
>
> å…¶ä¸­ k æ˜¯å°† è¡¨ç¤ºæˆäºŒè¿›åˆ¶ä»¥åï¼Œä»å³å‘å·¦æ•°ï¼Œé‡åˆ° 1 åˆ™åœæ­¢æ—¶ï¼Œæ•°å‡ºçš„ 0 çš„ä¸ªæ•°ã€‚
>
> ## é€šè¿‡ `lowbit` é«˜æ•ˆè®¡ç®— 2k
>
> ```java
> lowbit(i) = i & (-i)
> ```
>
> å¯¹ï¼Œå°±æ˜¯è¿™ä¹ˆç®€å•ã€‚ç†è§£è¿™è¡Œä¼ªä»£ç éœ€è¦ä¸€äº›äºŒè¿›åˆ¶å’Œä½è¿ç®—çš„çŸ¥è¯†ä½œä¸ºé“ºå«ã€‚
>
> é¦–å…ˆï¼Œæˆ‘ä»¬çŸ¥é“è´Ÿæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸ºï¼šç›¸åº”æ­£æ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºçš„åç  `+ 1`ã€‚
>
> > ä¾‹8ï¼šè®¡ç®— âˆ’6 çš„äºŒè¿›åˆ¶è¡¨ç¤ºã€‚
> >
> > åˆ†æï¼š6 çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸º 00000110ï¼Œå…ˆè¡¨ç¤ºæˆåç ï¼Œå³â€œ 0 å˜ 1ï¼Œ1 å˜ 0â€ï¼Œå¾—11111001ï¼Œå†åŠ  11ï¼Œå¾— 11111010ã€‚
> >
> > ä¾‹9ï¼šå½“ i = 6 æ—¶ï¼Œè®¡ç®— lowbit(i) ã€‚
> >
> > åˆ†æï¼šç”±ä¾‹ 7 åŠâ€œä¸â€è¿ç®—çš„å®šä¹‰ï¼ŒæŠŠå®ƒä»¬æŒ‰ç…§æ•°ä½å¯¹é½ä¸Šä¸‹å†™å¥½ï¼š
> >
> > ```
> > 0000 0110
> > 1111 1010
> > 0000 0010
> > ```
> >
> > è¯´æ˜ï¼šä¸Šä¸‹åŒæ—¶ä¸º 1 æ‰å†™ 1ï¼Œå¦åˆ™å†™ 0ï¼Œæœ€åå¾—åˆ° `0000 0010`ï¼Œè¿™ä¸ªäºŒè¿›åˆ¶æ•°è¡¨ç¤ºæˆåè¿›åˆ¶æ•°å°±æ˜¯ 2ã€‚å»ºè®®å¤§å®¶å¤šåœ¨ç¨¿çº¸ä¸Šå†™å‡ ä¸ªå…·ä½“çš„ä¾‹å­æ¥è®¡ç®—lowbitï¼Œè¿›è€Œç†è§£ä¸ºä»€ä¹ˆ lowbit(i)=2kã€‚
>
> ä¸‹é¢æˆ‘ç»™å‡ºä¸€ä¸ªæˆ‘çš„ç›´è§‚è§£é‡Šï¼šå¦‚æœæˆ‘ä»¬ç›´æ¥å°†ä¸€ä¸ªæ•´æ•°â€œæŒ‰ä½å–åâ€ï¼Œå†ä¸åŸæ¥çš„æ•°åšâ€œä¸â€è¿ç®—ï¼Œä¸€å®šå¾—åˆ° 0ã€‚å·§å°±å·§åœ¨ï¼Œè´Ÿæ•°çš„äºŒè¿›åˆ¶è¡¨ç¤ºä¸Šï¼Œé™¤äº†è¦æ±‚å¯¹â€œæŒ‰ä½å–åâ€ä»¥å¤–ï¼Œè¿˜è¦â€œåŠ â€ 1ï¼Œåœ¨â€œåŠ â€ 1 çš„è¿‡ç¨‹ä¸­äº§ç”Ÿçš„è¿›ä½æ•°å³æ˜¯â€œå°† i è¡¨ç¤ºæˆäºŒè¿›åˆ¶ä»¥åï¼Œä»å³å‘å·¦æ•°ï¼Œé‡åˆ° 1 åœæ­¢æ—¶æ•°å‡º 0 çš„ä¸ªæ•°â€ã€‚
>
> é‚£ä¹ˆæˆ‘ä»¬çŸ¥é“äº† lowbit ä»¥åï¼Œåˆæœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿç”±äºä½è¿ç®—æ˜¯ååˆ†é«˜æ•ˆçš„ï¼Œå®ƒèƒ½å¸®åŠ©æˆ‘ä»¬åœ¨æ ‘çŠ¶æ•°ç»„ä¸­é«˜æ•ˆè®¡ç®—â€œä»å­ç»“ç‚¹ç´¢å¼•åˆ°çˆ¶ç»“ç‚¹â€ï¼ˆå³å¯¹åº”â€œå•ç‚¹æ›´æ–°â€æ“ä½œï¼‰ï¼Œé«˜æ•ˆè®¡ç®—â€œå‰ç¼€å’Œç”±é¢„å¤„ç†æ•°ç»„çš„é‚£äº›å…ƒç´ è¡¨ç¤ºâ€ï¼ˆå³å¯¹åº”â€œå‰ç¼€å’ŒæŸ¥è¯¢æ“ä½œâ€ï¼‰ã€‚
>
> ## ä½“ä¼š `lowbit` çš„å¨åŠ›
>
> ### 1ã€ â€œå•ç‚¹æ›´æ–°â€æ“ä½œï¼šâ€œä»å­ç»“ç‚¹åˆ°çˆ¶ç»“ç‚¹â€
>
> 
>
> ![é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-8](https://liweiwei1419.github.io/images/algorithms/fenwick-tree/fenwick-tree-8.jpg)
>
> **é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-8**
>
> 
>
> > ä¾‹10ï¼šä¿®æ”¹ A[3]ï¼Œ åˆ†æå¯¹æ•°ç»„ C äº§ç”Ÿçš„å˜åŒ–ã€‚
> >
> > ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡º A[3] çš„çˆ¶ç»“ç‚¹ä»¥åŠç¥–å…ˆç»“ç‚¹ä¾æ¬¡æ˜¯C[3]ã€C[4]ã€C[8] ï¼Œæ‰€ä»¥ä¿®æ”¹äº†A[3] ä»¥å C[3]ã€C[4]ã€C[8] çš„å€¼ä¹Ÿè¦ä¿®æ”¹ã€‚
> >
> > å…ˆçœ‹ C[3] ï¼Œlowbit(3)=1ï¼Œ 3+lowbit(3)=4 å°±æ˜¯C[3] çš„çˆ¶äº²ç»“ç‚¹C[4] çš„ç´¢å¼•å€¼ã€‚
> >
> > å†çœ‹ C[4] ï¼Œlowbit(4)=4ï¼Œ 4+lowbit(4)=8 å°±æ˜¯C[4] çš„çˆ¶äº²ç»“ç‚¹C[8] çš„ç´¢å¼•å€¼ã€‚
> > ä»å›¾ä¸­ï¼Œä¹Ÿå¯ä»¥éªŒè¯ï¼šâ€œçº¢è‰²ç»“ç‚¹çš„ç´¢å¼•å€¼ + å³ä¸‹è§’è“è‰²åœ†å½¢ç»“ç‚¹çš„å€¼ = çº¢è‰²ç»“ç‚¹çš„åŒäº²ç»“ç‚¹çš„ç´¢å¼•å€¼â€ã€‚
>
> ä¸‹é¢æˆ‘è¯•å›¾è§£é‡Šè¿™ä¸ªç°è±¡ï¼š3 å³ 0011ï¼Œä»å³å‘å·¦ï¼Œé‡åˆ° 0 æ”¾è¿‡ï¼Œé‡åˆ° 1 ä¸ºæ­¢ï¼Œç»™è¿™ä¸ªæ•°ä½åŠ  1ï¼Œè¿™ä¸ªæ“ä½œå°±ç›¸å½“äºåŠ ä¸Šäº†ä¸€ä¸ª 2k çš„äºŒè¿›åˆ¶æ•°ï¼Œå³ä¸€ä¸ª lowbit å€¼ï¼Œæœ‰æ„æ€çš„äº‹æƒ…å°±å‘ç”Ÿåœ¨æ­¤æ—¶ï¼Œé©¬ä¸Šå°±å‘å‘ç”Ÿäº†è¿›ä½ï¼Œå¾—åˆ° 0100ï¼Œå³ 4 çš„äºŒè¿›åˆ¶è¡¨ç¤ºã€‚
> æ¥ä¸‹æ¥å¤„ç† 0100ï¼Œä»å³å‘å·¦ï¼Œä»å³å‘å·¦ï¼Œé‡åˆ° 0 æ”¾è¿‡ï¼Œé‡åˆ° 1 ä¸ºæ­¢ï¼Œç»™è¿™ä¸ªæ•°ä½åŠ  1ï¼ŒåŒæ ·åœ°ï¼Œè¿™ä¸ªæ“ä½œå°±ç›¸å½“äºåŠ ä¸Šäº†ä¸€ä¸ª 2k çš„äºŒè¿›åˆ¶æ•°ï¼Œå³ä¸€ä¸ªlowbit å€¼ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œé©¬ä¸Šå°±å‘å‘ç”Ÿäº†è¿›ä½ï¼Œå¾—åˆ° 1000ï¼Œå³ 8 çš„äºŒè¿›åˆ¶è¡¨ç¤ºã€‚
>
> ä»æˆ‘ä¸Šé¢çš„æè¿°ä¸­ï¼Œä½ å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬åˆåœ¨åšâ€œä»å³è¾¹åˆ°å·¦è¾¹æ•°ï¼Œé‡åˆ° 1 ä¹‹å‰æ•°å‡º 0 çš„ä¸ªæ•°â€è¿™ä»¶äº‹æƒ…äº†ï¼Œ
> ç”±æ­¤æˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºè§„å¾‹ï¼šä»å·²çŸ¥å­ç»“ç‚¹çš„ç´¢å¼•i ï¼Œåˆ™ç»“ç‚¹i çš„çˆ¶ç»“ç‚¹çš„ç´¢å¼•parent çš„è®¡ç®—å…¬å¼ä¸ºï¼š
>
> 
>
> parent(i)=i+lowbit(i)
>
> å¯ä¸è¿‡æˆ‘è¿˜æƒ³è¯´æ˜çš„æ˜¯ï¼Œè¿™ä¸æ˜¯å·§åˆå’Œå¾ªç¯è®ºè¯ï¼Œè¿™æ­£æ˜¯å› ä¸ºå¯¹ â€œä»å³è¾¹åˆ°å·¦è¾¹æ•°å‡º 0 çš„ä¸ªæ•°ï¼Œé‡åˆ° 1 åœæ­¢è¿™ä»¶äº‹æƒ…â€çš„å®šä¹‰ï¼Œä½¿ç”¨lowbit å¯ä»¥å¿«é€Ÿè®¡ç®—è¿™ä»¶äº‹æˆç«‹ï¼Œæ‰ä¼šæœ‰çš„ã€‚
>
> åˆ†æåˆ°è¿™é‡Œâ€œå•ç‚¹æ›´æ–°â€çš„ä»£ç å°±å¯ä»¥é©¬ä¸Šå†™å‡ºæ¥äº†ã€‚
>
> ### 2ã€ â€œå‰ç¼€å’ŒæŸ¥è¯¢æ“ä½œâ€ï¼šè®¡ç®—å‰ç¼€å’Œç”±é¢„å¤„ç†æ•°ç»„çš„é‚£äº›å…ƒç´ è¡¨ç¤ºâ€
>
> è¿˜æ˜¯ä¸Šé¢é‚£å¼ å›¾ã€‚
>
> 
>
> ![é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-9](https://liweiwei1419.github.io/images/algorithms/fenwick-tree/fenwick-tree-8.jpg)
>
> **é«˜çº§æ•°æ®ç»“æ„ï¼šæ ‘çŠ¶æ•°ç»„-9**
>
> 
>
> > ä¾‹ 11 ï¼šæ±‚å‡ºâ€œå‰ç¼€å’Œ6â€ã€‚
> >
> > ç”±å›¾å¯ä»¥çœ‹å‡ºâ€œå‰ç¼€å’Œ6 â€ = C[6] + C[4]ã€‚
> >
> > å…ˆçœ‹ C[6] ï¼Œlowbit(6)=2ï¼Œ 6âˆ’lowbit(6)=4 æ­£å¥½æ˜¯ C[6] çš„ä¸Šä¸€ä¸ªéå¶å­ç»“ç‚¹C[4] çš„ç´¢å¼•å€¼ã€‚è¿™é‡Œç»™å‡ºæˆ‘çš„ä¸€ä¸ªç›´è§‚è§£é‡Šï¼Œå¦‚æœä¸‹æ ‡è¡¨ç¤ºé«˜åº¦ï¼Œé‚£ä¹ˆä¸Šä¸€ä¸ªéå¶å­ç»“ç‚¹ï¼Œå…¶å®å°±æ˜¯ä»å³è¾¹å‘å·¦è¾¹ç”»ä¸€æ¡æ°´å¹³çº¿ï¼Œé‡åˆ°çš„å¢™çš„ç´¢å¼•ã€‚åªè¦è¿™ä¸ªå€¼å¤§äº 0ï¼Œéƒ½èƒ½æ­£ç¡®æ±‚å‡ºæ¥ã€‚
> >
> > ä¾‹ 12ï¼šæ±‚å‡ºâ€œå‰ç¼€å’Œ5â€ã€‚
> >
> > å†çœ‹C[5] ï¼Œlowbit(5)=1ï¼Œ5âˆ’lowbit(6)=4 æ­£å¥½æ˜¯ C[5] çš„ä¸Šä¸€ä¸ªéå¶å­ç»“ç‚¹C[4] çš„ç´¢å¼•å€¼ï¼Œæ•…â€œå‰ç¼€å’Œ5â€ = C[5] +C[4]ã€‚
> >
> > ä¾‹ 13ï¼šæ±‚å‡ºâ€œå‰ç¼€å’Œ7â€ã€‚
> >
> > å†çœ‹ C[7] ï¼Œlowbit(7)=1ï¼Œ 7âˆ’lowbit(7)=6 æ­£å¥½æ˜¯ C[7] çš„ä¸Šä¸€ä¸ªéå¶å­ç»“ç‚¹C[6] çš„ç´¢å¼•å€¼ï¼Œå†ç”±ä¾‹9 çš„åˆ†æï¼Œâ€œå‰ç¼€å’Œ7â€ =C[7] + C[6] + C[4]ã€‚
> >
> > ä¾‹ 14ï¼šæ±‚å‡ºâ€œå‰ç¼€å’Œ8â€ã€‚
> >
> > å†çœ‹ C[8] ï¼Œlowbit(8)=8ï¼Œ 8âˆ’lowbit(8)=0 ï¼Œ 0 è¡¨ç¤ºæ²¡æœ‰ï¼Œä»å›¾ä¸Šä¹Ÿå¯ä»¥çœ‹å‡ºä»å³è¾¹å‘å·¦è¾¹ç”»ä¸€æ¡æ°´å¹³çº¿ï¼Œä¸ä¼šé‡åˆ°çš„å¢™ï¼Œæ•…â€œå‰ç¼€å’Œ8â€ =C[8] ã€‚
>
> ç»è¿‡ä»¥ä¸Šçš„åˆ†æï¼Œæ±‚å‰ç¼€å’Œçš„ä»£ç ä¹Ÿå¯ä»¥å†™å‡ºæ¥äº†ã€‚
>
> 
>
> ## æ ‘çŠ¶æ•°ç»„çš„åˆå§‹åŒ–
>
> è¿™é‡Œè¦è¯´æ˜çš„æ˜¯ï¼Œåˆå§‹åŒ–å‰ç¼€å’Œæ•°ç»„åº”è¯¥äº¤ç»™è°ƒç”¨è€…æ¥å†³å®šã€‚ä¸‹é¢æ˜¯ä¸€ç§åˆå§‹åŒ–çš„æ–¹å¼ã€‚æ ‘çŠ¶æ•°ç»„çš„åˆå§‹åŒ–å¯ä»¥é€šè¿‡â€œå•ç‚¹æ›´æ–°â€æ¥å®ç°ï¼Œå› ä¸ºâ€œæœ€æœ€å¼€å§‹â€çš„æ—¶å€™ï¼Œæ•°ç»„çš„æ¯ä¸ªå…ƒç´ çš„å€¼éƒ½ä¸º 0ï¼Œæ¯ä¸ªéƒ½å¯¹åº”åœ°åŠ ä¸ŠåŸå§‹æ•°ç»„çš„å€¼ï¼Œå°±å®Œæˆäº†é¢„å¤„ç†æ•°ç»„ C çš„åˆ›å»ºã€‚
> è¿™é‡Œè¦ç‰¹åˆ«æ³¨æ„ï¼Œ`update` æ“ä½œçš„ç¬¬ 2 ä¸ªç´¢å¼•å€¼æ˜¯ä¸€ä¸ªå˜åŒ–å€¼ï¼Œè€Œä¸æ˜¯å˜åŒ–ä»¥åçš„å€¼ã€‚å› ä¸ºæˆ‘ä»¬çš„æ“ä½œæ˜¯é€å±‚ä¸ŠæŠ¥ï¼Œæ±‡æŠ¥å˜æ›´å€¼ä¼šè®©æˆ‘ä»¬çš„æ“ä½œæ›´åŠ ç®€å•ï¼Œè¿™ä¸€ç‚¹è¯·å¤§å®¶åå¤ä½“ä¼šã€‚
>
> #### ä¾‹å­ï¼š
>
> ```python
> # bowbit = i & (-i) = 2 ^ k (kè¡¨ç¤ºæœ€å³è¾¹ç¬¬kä½)
> # i=00100100 -1=11011100(11011011+1) æ‰€ä»¥å³è¾¹çš„ä¸€ä¸ª1å’Œå¾€åçš„0ä¼šè¢«ä¿ç•™
> # 3 + lowbit(3) = 4  å¾€æœ€å³çš„1åŠ 1ï¼Œåˆ™å†å¾€å·¦è¿ç»­çš„1éƒ½å˜æˆ0ï¼Œç¬¬ä¸€ä¸ª0å˜æˆ1
> # 0011 + 0001 = 0100
> 
> # ièŠ‚ç‚¹çˆ¶èŠ‚ç‚¹çš„ç´¢å¼•å…¬å¼ï¼šparent(i)=i+lowbit(i)
> 
> 
> class FenwickTree:
>     def __init__(self, n):
>         self.size = n
>         self.father = [0 for _ in range(n+1)]
> 
>     def _low_bit(self, x):
>         return x & (-x)
> 
>     def update(self, index, delta):
>         while index < self.size:
>             # æ›´æ–°å½“å‰èŠ‚ç‚¹çš„Cå€¼ï¼ˆç”¨äºå‰ç¼€å’Œè®¡ç®—ï¼‰
>             self.father[index] += delta
>             # è®¡ç®—æ”¶å…¶å½±å“çš„C
>             index = index + self._low_bit(index)
> 
>     def query(self, index):
>         res = 0
>         while index > 0:
>             res += self.father[index]
>             index = index - self._low_bit(index)
>         return res
> 
> 
> ```



> [æ¯æ—¥éŸ³ä¹:http://music.163.com/#/m/song?id=36229050](http://music.163.com/#/m/song?id=36229050)

### æ¯æ—¥ä¸€é¢˜

#### [è®¡ç®—å³ä¾§å°äºå½“å‰å…ƒç´ çš„ä¸ªæ•°](https://leetcode-cn.com/problems/count-of-smaller-numbers-after-self/)

ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ numsï¼ŒæŒ‰è¦æ±‚è¿”å›ä¸€ä¸ªæ–°æ•°ç»„ countsã€‚æ•°ç»„ counts æœ‰è¯¥æ€§è´¨ï¼š counts[i] çš„å€¼æ˜¯  nums[i] å³ä¾§å°äº nums[i] çš„å…ƒç´ çš„æ•°é‡ã€‚

ç¤ºä¾‹:

è¾“å…¥: [5,2,6,1]
è¾“å‡º: [2,1,1,0] 
è§£é‡Š:
5 çš„å³ä¾§æœ‰ 2 ä¸ªæ›´å°çš„å…ƒç´  (2 å’Œ 1).
2 çš„å³ä¾§ä»…æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  (1).
6 çš„å³ä¾§æœ‰ 1 ä¸ªæ›´å°çš„å…ƒç´  (1).
1 çš„å³ä¾§æœ‰ 0 ä¸ªæ›´å°çš„å…ƒç´ .

æ¥æºï¼šåŠ›æ‰£ï¼ˆLeetCodeï¼‰
é“¾æ¥ï¼šhttps://leetcode-cn.com/problems/count-of-smaller-numbers-after-self
